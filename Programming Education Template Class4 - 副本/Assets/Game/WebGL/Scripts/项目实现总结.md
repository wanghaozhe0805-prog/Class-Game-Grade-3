# Unity WebGL方块控制游戏 - 项目实现总结

## 项目概述

本项目是一个基于Unity开发的WebGL方块控制游戏，支持Web前端按钮控制方块在2D场景中上下左右移动，并能将方块的实时坐标通过WebGL主动回传给前端页面，实现前后端双向通信。

## 项目结构

- **PlayerController2D.cs**：方块移动控制器，处理键盘和前端按钮输入，实现上下左右移动。
- **WebGLBridge.cs**：前端按钮控制桥，接收前端SendMessage命令，调用方块控制方法。
- **WebGLEventBridge.cs**：Unity主动向前端发送事件的桥接脚本，物体移动后自动推送坐标。
- **WebGLInterface.jslib**：JS桥接库，实现Unity到前端的事件分发。
- **responsive_game_wrapper.html**：前端页面，集成Unity WebGL画布、控制按钮和坐标展示区。

## 核心功能

- **前端按钮控制**：网页按钮通过SendMessage调用Unity方法，实现方块上下左右移动和重置。
- **Unity主动回传**：方块每次移动后，Unity通过jslib桥接主动推送最新坐标到前端，前端实时展示。
- **双向通信**：支持前端→Unity控制，Unity→前端数据回传。

## 技术实现

### 1. 前端→Unity控制
- 前端按钮调用：
  ```js
  unityInstance.SendMessage('WebGLBridge', 'OnMoveForward');
  ```
- Unity场景中有名为WebGLBridge的GameObject，挂载WebGLBridge.cs，方法public void OnMoveForward()等。

### 2. Unity→前端回传
- Unity调用：
  ```csharp
  SendEventToJS("OnPlayerMoved", JsonUtility.ToJson(new { x, y, z }));
  ```
- WebGLInterface.jslib:
  ```js
  mergeInto(LibraryManager.library, {
    UnitySendMessage: function (eventname, data) {
      window.ReportReady(UTF8ToString(eventname), UTF8ToString(data));
    }
  });
  ```
- 前端监听：
  ```js
  window.addEventListener('OnPlayerMoved', (e) => {
    const pos = JSON.parse(e.detail.data);
    // 处理坐标
  });
  ```

## 场景搭建

- Main Camera：正交摄像机，俯视2D场景
- player：空物体，挂载SpriteRenderer（显示方块）和PlayerController2D
- WebGLBridge：空物体，挂载WebGLBridge脚本，Player Controller字段指向player
- WebGLEventBridge：空物体，挂载WebGLEventBridge脚本

## 前端页面结构

- Unity WebGL画布
- 控制按钮（前进、后退、左移、右移、重置）
- 实时坐标展示区

## 部署与测试

1. Unity Build WebGL，确保jslib被正确打包
2. 将Build目录和responsive_game_wrapper.html部署到Web服务器
3. 浏览器访问页面，测试按钮控制和坐标回传
本地服务器可用python测试：python -m http.server 8080
网页访问地址：http://localhost:8080/responsive_game_wrapper.html
## 特色与扩展

- 支持移动端和PC端响应式布局
- 可扩展为多物体、多事件、属性回传等
- 适合教学、演示、前后端通信范例

